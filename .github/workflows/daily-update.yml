name: 4 Saatlik ÃœrÃ¼n GÃ¼ncelleme

on:
  # 1. HER 4 SAATTE BÄ°R OTOMATÄ°K (Bu aynen kalsÄ±n)
  schedule:
    - cron: '0 */4 * * *'

  # 2. SADECE SCRAPER DOSYASI DEÄžÄ°ÅžÄ°RSE Ã‡ALIÅž (FÄ°LTRE)
  push:
    branches:
      - main
      - master
    paths:
      - 'scraper-fixed.js'               # <-- Sadece bu dosya deÄŸiÅŸirse tetikle
      - '.github/workflows/daily-update.yml' # <-- Veya bu ayar dosyasÄ± deÄŸiÅŸirse

  # 3. MANUEL BUTON (Aynen kalsÄ±n)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  scrape-and-update:
    runs-on: ubuntu-latest

    steps:
    - name: Depoyu Ã‡ek
      uses: actions/checkout@v3

    - name: Node.js Kurulumu
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Paketleri YÃ¼kle
      run: npm install

    - name: Scraper'Ä± BaÅŸlat
      run: node scraper-fixed.js

    - name: SonuÃ§larÄ± Kaydet
      run: |
        git config --global user.name 'Otomatik Bot'
        git config --global user.email 'bot@noreply.github.com'
        git add public/trendyol_products.js public/trendyol_products.json
        # DeÄŸiÅŸiklik varsa commit at, yoksa hata verme
        git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ¤– Otomatik GÃ¼ncelleme" && git push)
