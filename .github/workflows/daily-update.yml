name: 4 Saatlik ÃœrÃ¼n GÃ¼ncelleme

on:
  # 1. HER 4 SAATTE BÄ°R OTOMATÄ°K Ã‡ALIÅIR
  # (UTC saatiyle: 00:00, 04:00, 08:00, 12:00, 16:00, 20:00)
  # (TÃ¼rkiye saatiyle: 03:00, 07:00, 11:00, 15:00, 19:00, 23:00)
  schedule:
    - cron: '0 */4 * * *'

  # 2. SEN KOD YÃœKLEDÄ°ÄÄ°NDE Ã‡ALIÅIR (Test iÃ§in)
  push:
    branches:
      - main
      - master

  # 3. GITHUB SÄ°TESÄ°NDEKÄ° "RUN" BUTONUNU AKTÄ°F EDER
  workflow_dispatch:

# Git'e dosya yÃ¼kleyebilmesi iÃ§in izin
permissions:
  contents: write

jobs:
  scrape-and-update:
    runs-on: ubuntu-latest

    steps:
    # AdÄ±m 1: Senin kodlarÄ±nÄ± GitHub sunucusuna indir
    - name: Depoyu Ã‡ek (Checkout)
      uses: actions/checkout@v3

    # AdÄ±m 2: Node.js (Javascript motoru) kur
    - name: Node.js Kurulumu
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    # AdÄ±m 3: Gerekli paketleri (Puppeteer vb.) yÃ¼kle
    - name: Paketleri YÃ¼kle
      run: npm install

    # AdÄ±m 4: Scraper Kodunu Ã‡alÄ±ÅŸtÄ±r
    - name: Scraper'Ä± BaÅŸlat
      run: node scraper-fixed.js
      # Not: 'scraper-fixed.js' dosyanÄ±n ana dizinde olduÄŸundan emin ol.

    # AdÄ±m 5: OluÅŸan dosyalarÄ± (js ve json) GitHub'a geri yÃ¼kle
    - name: DeÄŸiÅŸiklikleri Kaydet ve GÃ¶nder (Push)
      run: |
        git config --global user.name 'Otomatik Bot'
        git config --global user.email 'bot@noreply.github.com'
        
        # Public klasÃ¶rÃ¼ndeki yeni dosyalarÄ± ekle
        git add public/trendyol_products.js public/trendyol_products.json
        
        # EÄŸer deÄŸiÅŸiklik varsa commit at ve pushla, yoksa hata verme
        git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ¤– 4 Saatlik Otomatik GÃ¼ncelleme" && git push)
